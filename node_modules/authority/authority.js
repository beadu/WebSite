var logger = require('logger');
var unload = require('unload');

exports.filter = function (bus, fn) {
    if (!bus.engine)
        unload.exec({ code: 404, msg: '没有找到您需要的服务' });

    var auth = bus.engine.auth;
    if (!auth)
        unload.exec({ code: 500, msg: '没有权限' });
    var method = bus.req.method;
    if (method === 'GET') {
        if (auth.get === 'private' ||
            (auth.get === 'protected' && !bus.identity.isLogin)) {
            unload.exec({ code: 500, msg: '您没有权限' });
            return;
        }
    } else if (method === 'POST') {
        if (auth.post === 'private' ||
            (auth.post === 'protected' && !bus.identity.isLogin)) {
            unload.exec({ code: 500, msg: '您没有权限' });
            return;
        }
    }
    fn(bus);
};